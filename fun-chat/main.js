(()=>{"use strict";var e={91:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(601),r=n.n(s),i=n(314),o=n.n(i)()(r());o.push([e.id,".login-block {\n    width: 300px;\n    height: 300px;\n    border: 1px solid #3d5a80;\n    background-color: #98c1d9;\n    border-radius: 5px;\n    padding: 10px;\n    text-align: center;\n    margin: auto;\n}\n\n.login-form {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    align-items: center;\n    margin: 10px;\n    margin-top: 5%;\n}\n\n.login-form__input {\n    margin-top: 8px;\n    margin-bottom: 8px;\n    padding: 5px;\n    border-radius: 5px;\n    max-width: 90%;\n}\n\n.valid {\n    border: 1px solid green;\n}\n\n.invalid {\n    border: 1px solid red;\n}\n\n.login-form__error {\n    min-height: 2rem;\n    display: block;\n    font-size: 0.7rem;\n    letter-spacing: 0.8px;\n    color: red;\n    position: relative;\n}\n\ninput.invalid + span:after {\n    content: attr(data-error-text);\n    display: inline-block;\n}\n",""]);const a=o},315:(e,t,n)=>{n.d(t,{A:()=>u});var s=n(601),r=n.n(s),i=n(314),o=n.n(i),a=n(417),c=n.n(a),d=new URL(n(691),n.b),l=o()(r()),p=c()(d);l.push([e.id,`.container {\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n}\n\nmain {\n    margin: 20px;\n    flex-grow: 1;\n    height: 65svh;\n}\n\nheader,\n.footer {\n    display: flex;\n    align-items: center;\n    padding: 10px;\n    background-color: #98c1d9;\n    justify-content: space-between;\n}\n\n.footer {\n    justify-content: center;\n    font-size: 12px;\n    gap: 10px;\n}\n.footer p {\n    width: 80px;\n}\n\n.footer__rss {\n    display: block;\n    width: 100px;\n    height: 30px;\n    background-image: url(${p});\n    background-repeat: no-repeat;\n    background-size: contain;\n    opacity: 0.7;\n}\n\n.status-online {\n    display: inline-block;\n    background: #3ca84b;\n\n    border: 1px solid;\n    border-radius: 50%;\n    box-sizing: border-box;\n    height: 6px;\n    margin-right: 1%;\n    width: 7px;\n}\n.status-offline {\n    display: inline-block;\n    background: #8b0000;\n    border: 1px solid;\n    border-radius: 50%;\n    box-sizing: border-box;\n    height: 6px;\n    margin-right: 1%;\n    width: 7px;\n}\n\n.user-list {\n    height: 100%;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    overflow-y: scroll;\n    scrollbar-width: thin;\n    padding: 1%;\n    width: 30%;\n    border: 1px solid #293241;\n    border-radius: 5px;\n}\n\n.line {\n    display: flex;\n    align-items: center;\n}\n`,""]);const u=l},208:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(601),r=n.n(s),i=n(314),o=n.n(i)()(r());o.push([e.id,"* {\n    margin: 0;\n    box-sizing: border-box;\n    font-family: 'Poppins';\n    color: #293241;\n}\n\nbody {\n    height: 100vh;\n}\n\na {\n    text-decoration: none;\n}\n\na:visited {\n    color: inherit;\n}\n\nli {\n    list-style-type: none;\n}\n\nbutton {\n    cursor: pointer;\n    width: 80px;\n    text-transform: capitalize;\n    background-color: #e0fbfc;\n    border: none;\n    border-radius: 5px;\n    margin: 5px;\n    transition: 0.3s linear;\n}\n\nbutton:hover:not(:disabled) {\n    background-color: #ee6c4d;\n    transition: 0.3s linear;\n}\n\nbutton:disabled {\n    cursor: not-allowed;\n    opacity: 0.7;\n}\n\n.wrapper {\n    height: 100%;\n    display: grid;\n    align-items: center;\n    justify-content: center;\n}\n\n.overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 40px;\n    backdrop-filter: blur(1px);\n}\n.block-centered {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n    gap: 20px;\n    padding: 20px;\n    margin: 10px;\n    border: 1px solid #3d5a80;\n    background-color: #98c1d9;\n    max-width: 450px;\n    min-width: 250px;\n    border-radius: 10px;\n}\n\n.disabled {\n    pointer-events: none;\n    opacity: 0.7;\n}\n",""]);const a=o},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",s=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),s&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),s&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,s,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(s)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);s&&o[l[0]]||(void 0!==i&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=i),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,s=0;s<t.length;s++)if(t[s].identifier===e){n=s;break}return n}function s(e,s){for(var i={},o=[],a=0;a<e.length;a++){var c=e[a],d=s.base?c[0]+s.base:c[0],l=i[d]||0,p="".concat(d," ").concat(l);i[d]=l+1;var u=n(p),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)t[u].references++,t[u].updater(h);else{var g=r(h,s);s.byIndex=a,t.splice(a,0,{identifier:p,updater:g,references:1})}o.push(p)}return o}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var i=s(e=e||[],r=r||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var a=n(i[o]);t[a].references--}for(var c=s(e,r),d=0;d<i.length;d++){var l=n(i[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}i=c}}},659:e=>{var t={};e.exports=function(e,n){var s=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,r&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},691:(e,t,n)=>{e.exports=n.p+"assets/rs_school_js.ad178c0df28bc133be34.svg"}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={id:s,exports:{}};return e[s](i,i.exports,n),i.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var r=s.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=s[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,n.nc=void 0,(()=>{class e{constructor(e,...t){this.children=[];const n=document.createElement(e.tag??"div");Object.assign(n,e),e.data&&Object.entries(e.data).forEach((([e,t])=>{n.dataset[e]=t})),this.node=n,t&&this.appendChildren(t)}append(t){t instanceof e?(this.children.push(t),this.node.append(t.getNode())):this.node.append(t)}appendChildren(e){e.forEach((e=>{e&&this.append(e)}))}setTextContent(e){this.node.textContent=e}getNode(){return this.node}addClass(e){this.node.classList.add(e)}removeClass(e){this.node.classList.remove(e)}addListener(e,t){this.node.addEventListener(e,t)}destroyChildren(){this.children.forEach((e=>{e.destroy()})),this.children.length=0}destroy(){this.destroyChildren(),this.node.remove()}}class t extends e{constructor(e){super(e),this.app=z.getInstance(),this.render()}}class s extends t{constructor(){super({className:"wrapper"})}render(){const t=new e({className:"block-centered"}),n=new e({tag:"a",href:"https://github.com/tatsianask108",textContent:"Tatsiana (github)"}),s=new e({tag:"p",textContent:"This application was created while participating in the Rolling Scopes School course"}),r=new e({tag:"button",className:"back-btn",textContent:"back"});r.addListener("click",(()=>{window.location.href="#/login"})),t.appendChildren([s,n,r]),this.append(t)}}const r=new e({tag:"form",className:"login-form",action:"#",autocomplete:"off"},new e({tag:"input",type:"text",name:"name",autocomplete:"username",className:"login-form__input",placeholder:"Name",pattern:"[A-Z][A-Za-z\\-]{2,}",required:!0}),new e({tag:"span",className:"login-form__error",data:{errorText:"Enter your name starting with the capital letter, minimal length is 3"}}),new e({tag:"input",type:"password",name:"password",autocomplete:"current-password",className:"login-form__input",placeholder:"Password",pattern:"(?=.*[0-9]).{4,}",required:!0}),new e({tag:"span",className:"login-form__error",data:{errorText:"Password should contain at least one digit, minimal length is 4"}}),new e({tag:"button",className:"button",textContent:"Login",disabled:!0})).getNode(),i=new e({tag:"button",className:"about-btn",textContent:"About"});i.addListener("click",(()=>{window.location.href="#/about"}));const o=i.getNode();class a extends e{constructor(t){super({className:"overlay"});const n=new e({tag:"button",textContent:"Close"});n.addListener("click",this.close.bind(this)),this.modalContent=new e({className:"block-centered",textContent:t},n),this.appendChildren([this.modalContent])}open(){document.body.append(this.node),setTimeout((()=>{this.close()}),4e3)}close(){this.destroy()}}var c=n(72),d=n.n(c),l=n(825),p=n.n(l),u=n(659),h=n.n(u),g=n(56),m=n.n(g),f=n(540),v=n.n(f),w=n(113),b=n.n(w),x=n(91),y={};y.styleTagTransform=b(),y.setAttributes=m(),y.insert=h().bind(null,"head"),y.domAPI=p(),y.insertStyleElement=v(),d()(x.A,y),x.A&&x.A.locals&&x.A.locals;class L extends t{constructor(){super({className:"wrapper"})}render(){const t=new e({className:"login-block"},new e({tag:"p",className:"login-title",textContent:"Enter your name and password"}),r,o);r.addEventListener("keyup",this.handleKeyUp),r.addEventListener("submit",(e=>{this.handleSubmit(e)})),this.appendChildren([t])}handleKeyUp(e){const t=e.target;if(!t||!t.form)return;const{form:n}=t;t.checkValidity()?(t.classList.remove("invalid"),t.classList.add("valid")):(t.classList.remove("valid"),t.classList.add("invalid"));const s=n.querySelector("button");n.checkValidity()?s?.removeAttribute("disabled"):s?.setAttribute("disabled","disabled")}handleSubmit(e){const t=e.target;if(!t)return;e.preventDefault();const n={user:{login:t.getElementsByTagName("input")[0].value||"",password:t.getElementsByTagName("input")[1].value||""}};sessionStorage.setItem("user",JSON.stringify(n)),this.app.authService.auth(n).then((e=>{e.authorized?window.location.href="#/main":new a(e.message).open()})).catch((e=>{console.error(e)}))}}const S=new e({className:"footer"},new e({tag:"span",textContent:"2024"}),new e({tag:"a",href:"https://github.com/tatsianask108",textContent:"Tatsiana (github)"}),new e({tag:"a",href:"https://rs.school/",target:"_blank",className:"footer__rss"})).getNode();class E{constructor(){this.eventList={}}on(e,t){return this.eventList[e]||(this.eventList[e]=[]),this.eventList[e].push(t),()=>this.off(e,t)}once(e,t){const n=this.on(e,((...e)=>{n(),t(...e)}))}off(e,t){this.eventList[e]=t?this.eventList[e].filter((e=>t!==e)):[]}emit(e,...t){this.eventList[e]&&this.eventList[e].forEach((e=>{e.call(this,t)}))}}var N;new E,function(e){e.LOGIN="login",e.LOGOUT="logout"}(N||(N={}));class C extends E{constructor(e){super(),this.login=e.login,this.isLogined=e.isLogined}}class k{constructor(e){this.wsService=e,this.users=new Map,this.initListeners()}async loadActiveUsers(){(await this.wsService.message("USER_ACTIVE",{payload:null})).users.forEach((e=>{this.users.set(e.login,new C(e))}))}async loadInactiveUsers(){(await this.wsService.message("USER_INACTIVE",{payload:null})).users.forEach((e=>{this.users.set(e.login,new C(e))}))}initListeners(){this.wsService.getWebsocket().addEventListener("message",(e=>{const{data:t}=e;if(!t)return;const n=JSON.parse(t);"USER_EXTERNAL_LOGIN"===n.type?this.users.get(n.payload.user.login)?.emit(N.LOGIN):"USER_EXTERNAL_LOGOUT"===n.type&&this.users.get(n.payload.user.login)?.emit(N.LOGOUT)}))}async getParticipants(){return await this.loadActiveUsers(),await this.loadInactiveUsers(),Array.from(this.users.values())}}var A,T=n(315),O={};O.styleTagTransform=b(),O.setAttributes=m(),O.insert=h().bind(null,"head"),O.domAPI=p(),O.insertStyleElement=v(),d()(T.A,O),T.A&&T.A.locals&&T.A.locals;class U extends t{constructor(){super({className:"container"}),this.wsService=this.app.getWs(),this.chatService=new k(this.wsService),this.renderUserList()}getCurrUserLogin(){const e=sessionStorage.getItem("user");return e?JSON.parse(e).login:""}async render(){const t=new e({tag:"header",className:"header"},new e({tag:"h1",textContent:"Fun Chat"})),n=document.createElement("main"),s=document.createElement("button"),r=this.getCurrUserLogin(),i=new e({tag:"p",textContent:`username: ${r}`});t.appendChildren([i]),s.textContent="Logout",s.addEventListener("click",(async()=>{await this.app.authService.logout(),window.location.href="#/"}));const a=document.createElement("div");a.append(s,o),t.appendChildren([a]),this.appendChildren([t,n,S])}async renderUserList(){const t=new e({tag:"ul",className:"user-list"}),n=(await this.chatService.getParticipants()).filter((e=>e.login!==this.getCurrUserLogin())).map((e=>this.createParticipantElement(e))),s=this.getNode().querySelector("main");s&&(t.getNode().append(...n),s.append(t.getNode()))}createParticipantElement(e){const t=document.createElement("li"),n=document.createElement("span"),s=document.createElement("span");return t.id=`user-${e.login}`,t.classList.add("line"),s.textContent=e.login,s.className="userLogin",n.className=e.isLogined?"status-online":"status-offline",t.append(n,s),e.on(N.LOGIN,(()=>{n.className="status-online"})),e.on(N.LOGOUT,(()=>{n.className="status-offline"})),t}}class _ extends t{constructor(){super({className:"wrapper"})}render(){const e=document.createElement("div");e.classList.add("not-found"),e.textContent="404",this.append(e)}}class I{constructor(e){this.storage=sessionStorage,this.isAuthorized=!1,this.wsService=e}isAuth(){return this.isAuthorized}getUserData(){const e=this.storage.getItem("user");return e?JSON.parse(e):null}setUserData(e){this.storage.setItem("user",JSON.stringify(e))}async auth(e){const t=await this.wsService.message("USER_LOGIN",e),n={authorized:!1,message:""};return t.user&&t.user.isLogined?(this.isAuthorized=!0,this.setUserData(e.user)):t.error&&(n.message=t.error),n.authorized=this.isAuthorized,n}async logout(){const e=this.getUserData();e&&(await this.wsService.message("USER_LOGOUT",{user:e}),this.storage.clear(),this.isAuthorized=!1)}async loginStorage(){const e=this.getUserData();if(e){const t=await this.wsService.message("USER_LOGIN",{user:e});t.user&&t.user.isLogined&&(this.isAuthorized=!0)}return this.isAuthorized}}!function(e){e.OPEN="open",e.CLOSE="close",e.ERROR="error"}(A||(A={}));class P extends E{constructor(){super(),this.options={server:"ws://localhost:4000",timeout:3e4},this.socket=new WebSocket(this.options.server),this.addListeners()}addListeners(){this.socket.addEventListener("open",(()=>{this.emit(A.OPEN)})),this.socket.addEventListener("close",(()=>{this.emit(A.CLOSE),this.socket=new WebSocket(this.options.server),this.addListeners()})),this.socket.addEventListener("error",(()=>{this.emit(A.ERROR)}))}message(e,t){return new Promise(((n,s)=>{const r=Date.now(),i={id:r.toString(),type:e,payload:t},o=e=>{const{data:t}=e;if(!t)return;const s=JSON.parse(t);parseInt(s.id,10)===r&&(this.socket.removeEventListener("message",o),n(s.payload))};setTimeout((()=>{s(new Error("Timeout")),this.socket.removeEventListener("message",o)}),this.options.timeout),this.socket.addEventListener("message",o),this.socket.send(JSON.stringify(i))}))}getWebsocket(){return this.socket}}class R{constructor(e){this.root=e;const t=document.createElement("div");t.textContent="Connecting ...",this.loader=t,this.wsService=new P,this.authService=new I(this.wsService),this.wsService.on("open",(async()=>{this.loader.remove(),await this.authService.loginStorage(),this.page?this.root.append(this.page.getNode()):window.location.href="#/login"})),this.wsService.on("close",(()=>{this.root.append(this.loader),this.page&&this.page.getNode().remove()}))}static getInstance(){return R.instance||(R.instance=new R(document.body)),R.instance}renderPage(e){this.page&&this.page.destroy(),this.page=e,this.root.append(e.getNode())}getWs(){return this.wsService}}R.instance=null;const z=R,j=R.getInstance(),G=new Map([["/not-found",()=>{window.location.href="#/not-found",j.renderPage(new _)}],["/",()=>{window.location.href="#/login"}],["/login",()=>{j.authService.isAuth()&&(window.location.href="#/main"),j.renderPage(new L)}],["/about",()=>{j.renderPage(new s)}],["/main",()=>{j.authService.isAuth()||(window.location.href="#/login"),j.renderPage(new U)}]]),M=()=>{const e=window.location.hash.slice(1).toLowerCase(),t=G.get(e||"/")||G.get("/not-found");t&&t()};window.addEventListener("hashchange",M),window.addEventListener("load",(async()=>{j.wsService.once("open",(async()=>{await j.authService.loginStorage(),M()}))}));var D=n(208),J={};J.styleTagTransform=b(),J.setAttributes=m(),J.insert=h().bind(null,"head"),J.domAPI=p(),J.insertStyleElement=v(),d()(D.A,J),D.A&&D.A.locals&&D.A.locals,console.log("Дорогой проверяющий! В моей работе выполнены пункты 1-4, 9-11, частично пункт 5.")})()})();