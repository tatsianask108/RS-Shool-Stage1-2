(()=>{"use strict";var e={91:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(601),r=n.n(s),o=n(314),i=n.n(o)()(r());i.push([e.id,".login-block {\n    width: 300px;\n    height: 300px;\n    border: 1px solid #3d5a80;\n    background-color: #98c1d9;\n    border-radius: 5px;\n    padding: 10px;\n    text-align: center;\n    margin: auto;\n}\n\n.login-form {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    align-items: center;\n    margin: 10px;\n    margin-top: 5%;\n}\n\n.login-form__input {\n    margin-top: 8px;\n    margin-bottom: 8px;\n    padding: 5px;\n    border-radius: 5px;\n    max-width: 90%;\n}\n\n.valid {\n    border: 1px solid green;\n}\n\n.invalid {\n    border: 1px solid red;\n}\n\n.login-form__error {\n    min-height: 2rem;\n    display: block;\n    font-size: 0.7rem;\n    letter-spacing: 0.8px;\n    color: red;\n    position: relative;\n}\n\ninput.invalid + span:after {\n    content: attr(data-error-text);\n    display: inline-block;\n}\n",""]);const a=i},315:(e,t,n)=>{n.d(t,{A:()=>u});var s=n(601),r=n.n(s),o=n(314),i=n.n(o),a=n(417),c=n.n(a),d=new URL(n(691),n.b),l=i()(r()),p=c()(d);l.push([e.id,`.container {\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n}\n\nmain {\n    margin: 20px;\n    flex-grow: 1;\n    height: 65svh;\n}\n\nheader,\n.footer {\n    display: flex;\n    align-items: center;\n    padding: 10px;\n    background-color: #98c1d9;\n    justify-content: space-between;\n}\n\n.footer {\n    justify-content: center;\n    font-size: 12px;\n    gap: 10px;\n}\n.footer p {\n    width: 80px;\n}\n\n.footer__rss {\n    display: block;\n    width: 100px;\n    height: 30px;\n    background-image: url(${p});\n    background-repeat: no-repeat;\n    background-size: contain;\n    opacity: 0.7;\n}\n\n.status-online {\n    display: inline-block;\n    background: #3ca84b;\n\n    border: 1px solid;\n    border-radius: 50%;\n    box-sizing: border-box;\n    height: 6px;\n    margin-right: 1%;\n    width: 7px;\n}\n.status-offline {\n    display: inline-block;\n    background: #8b0000;\n    border: 1px solid;\n    border-radius: 50%;\n    box-sizing: border-box;\n    height: 6px;\n    margin-right: 1%;\n    width: 7px;\n}\n\n.user-list {\n    height: 100%;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: column;\n    justify-content: flex-start;\n    overflow-y: scroll;\n    scrollbar-width: thin;\n    padding: 1%;\n    width: 30%;\n    border: 1px solid #293241;\n    border-radius: 5px;\n}\n\n.line {\n    display: flex;\n    align-items: center;\n}\n`,""]);const u=l},208:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(601),r=n.n(s),o=n(314),i=n.n(o)()(r());i.push([e.id,"* {\n    margin: 0;\n    box-sizing: border-box;\n    font-family: 'Poppins';\n    color: #293241;\n}\n\nbody {\n    height: 100vh;\n}\n\na {\n    text-decoration: none;\n}\n\na:visited {\n    color: inherit;\n}\n\nli {\n    list-style-type: none;\n}\n\nbutton {\n    cursor: pointer;\n    width: 80px;\n    text-transform: capitalize;\n    background-color: #e0fbfc;\n    border: none;\n    border-radius: 5px;\n    margin: 5px;\n    transition: 0.3s linear;\n}\n\nbutton:hover:not(:disabled) {\n    background-color: #ee6c4d;\n    transition: 0.3s linear;\n}\n\nbutton:disabled {\n    cursor: not-allowed;\n    opacity: 0.7;\n}\n\n.wrapper {\n    height: 100%;\n    display: grid;\n    align-items: center;\n    justify-content: center;\n}\n\n.overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100vh;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 40px;\n    backdrop-filter: blur(1px);\n}\n.block-centered {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n    gap: 20px;\n    padding: 20px;\n    margin: 10px;\n    border: 1px solid #3d5a80;\n    background-color: #98c1d9;\n    max-width: 450px;\n    min-width: 250px;\n    border-radius: 10px;\n}\n\n.disabled {\n    pointer-events: none;\n    opacity: 0.7;\n}\n",""]);const a=i},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",s=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),s&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),s&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,s,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(s)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(i[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);s&&i[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,s=0;s<t.length;s++)if(t[s].identifier===e){n=s;break}return n}function s(e,s){for(var o={},i=[],a=0;a<e.length;a++){var c=e[a],d=s.base?c[0]+s.base:c[0],l=o[d]||0,p="".concat(d," ").concat(l);o[d]=l+1;var u=n(p),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)t[u].references++,t[u].updater(h);else{var g=r(h,s);s.byIndex=a,t.splice(a,0,{identifier:p,updater:g,references:1})}i.push(p)}return i}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=s(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var a=n(o[i]);t[a].references--}for(var c=s(e,r),d=0;d<o.length;d++){var l=n(o[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=c}}},659:e=>{var t={};e.exports=function(e,n){var s=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,r&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},691:(e,t,n)=>{e.exports=n.p+"assets/rs_school_js.ad178c0df28bc133be34.svg"}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={id:s,exports:{}};return e[s](o,o.exports,n),o.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var r=s.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=s[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,n.nc=void 0,(()=>{class e{constructor(e,...t){this.children=[];const n=document.createElement(e.tag??"div");Object.assign(n,e),e.data&&Object.entries(e.data).forEach((([e,t])=>{n.dataset[e]=t})),this.node=n,t&&this.appendChildren(t)}append(t){t instanceof e?(this.children.push(t),this.node.append(t.getNode())):this.node.append(t)}appendChildren(e){e.forEach((e=>{e&&this.append(e)}))}setTextContent(e){this.node.textContent=e}getNode(){return this.node}addClass(e){this.node.classList.add(e)}removeClass(e){this.node.classList.remove(e)}addListener(e,t){this.node.addEventListener(e,t)}destroyChildren(){this.children.forEach((e=>{e.destroy()})),this.children.length=0}destroy(){this.destroyChildren(),this.node.remove()}}class t extends e{constructor(e){super(e),this.app=I.getInstance(),this.render()}}class s extends t{constructor(){super({className:"wrapper"})}render(){const t=new e({className:"block-centered"}),n=new e({tag:"a",href:"https://github.com/tatsianask108",textContent:"Tatsiana (github)"}),s=new e({tag:"p",textContent:"This application was created while participating in the Rolling Scopes School course"}),r=new e({tag:"button",className:"back-btn",textContent:"back"});r.addListener("click",(()=>{window.location.href="#/login"})),t.appendChildren([s,n,r]),this.append(t)}}const r=new e({tag:"button",className:"about-btn",textContent:"About"});r.addListener("click",(()=>{window.location.href="#/about"}));const o=r.getNode();class i extends e{constructor(t){super({className:"overlay"});const n=new e({tag:"button",textContent:"Close"});n.addListener("click",this.close.bind(this)),this.modalContent=new e({className:"block-centered",textContent:t},n),this.appendChildren([this.modalContent])}open(){document.body.append(this.node),setTimeout((()=>{this.close()}),4e3)}close(){this.destroy()}}var a=n(72),c=n.n(a),d=n(825),l=n.n(d),p=n(659),u=n.n(p),h=n(56),g=n.n(h),m=n(540),f=n.n(m),v=n(113),w=n.n(v),b=n(91),x={};x.styleTagTransform=w(),x.setAttributes=g(),x.insert=u().bind(null,"head"),x.domAPI=l(),x.insertStyleElement=f(),c()(b.A,x),b.A&&b.A.locals&&b.A.locals;class y extends t{constructor(){super({className:"wrapper"})}render(){const t=new e({tag:"form",className:"login-form",action:"#",autocomplete:"off"},new e({tag:"input",type:"text",name:"name",autocomplete:"username",className:"login-form__input",placeholder:"Name",pattern:"[A-Z][A-Za-z\\-]{2,}",required:!0}),new e({tag:"span",className:"login-form__error",data:{errorText:"Enter your name starting with the capital letter, minimal length is 3"}}),new e({tag:"input",type:"password",name:"password",autocomplete:"current-password",className:"login-form__input",placeholder:"Password",pattern:"(?=.*[0-9]).{4,}",required:!0}),new e({tag:"span",className:"login-form__error",data:{errorText:"Password should contain at least one digit, minimal length is 4"}}),new e({tag:"button",className:"button",textContent:"Login",disabled:!0})),n=new e({className:"login-block"},new e({tag:"p",className:"login-title",textContent:"Enter your name and password"}),t,o);t.getNode().addEventListener("keyup",this.handleKeyUp),t.getNode().addEventListener("submit",(e=>{this.handleSubmit(e)})),this.appendChildren([n])}handleKeyUp(e){const t=e.target;if(!t||!t.form)return;const{form:n}=t;t.checkValidity()?(t.classList.remove("invalid"),t.classList.add("valid")):(t.classList.remove("valid"),t.classList.add("invalid"));const s=n.querySelector("button");n.checkValidity()?s?.removeAttribute("disabled"):s?.setAttribute("disabled","disabled")}handleSubmit(e){const t=e.target;if(!t)return;e.preventDefault();const n={user:{login:t.getElementsByTagName("input")[0].value||"",password:t.getElementsByTagName("input")[1].value||""}};sessionStorage.setItem("user",JSON.stringify(n)),this.app.authService.auth(n).then((e=>{e.authorized?window.location.href="#/main":new i(e.message).open()})).catch((e=>{console.error(e)}))}}const S=new e({className:"footer"},new e({tag:"span",textContent:"2024"}),new e({tag:"a",href:"https://github.com/tatsianask108",textContent:"Tatsiana (github)"}),new e({tag:"a",href:"https://rs.school/",target:"_blank",className:"footer__rss"})).getNode();class L{constructor(e){this.wsService=e,this.getActiveUsers()}async getActiveUsers(){const e=await this.wsService.message("USER_ACTIVE",{payload:null});return console.log(e.users),e.users}async getUnauthorizedUsers(){const e=await this.wsService.message("USER_INACTIVE",{payload:null});return console.log(e.users),e.users}}var N=n(315),E={};E.styleTagTransform=w(),E.setAttributes=g(),E.insert=u().bind(null,"head"),E.domAPI=l(),E.insertStyleElement=f(),c()(N.A,E),N.A&&N.A.locals&&N.A.locals;class C extends t{constructor(){super({className:"container"}),this.wsService=this.app.getWs(),this.chatService=new L(this.wsService),this.renderUserList()}getCurrUserLogin(){const e=sessionStorage.getItem("user");return e?JSON.parse(e).login:""}async render(){const t=new e({tag:"header",className:"header"},new e({tag:"h1",textContent:"Fun Chat"})),n=document.createElement("main"),s=document.createElement("button"),r=this.getCurrUserLogin(),i=new e({tag:"p",textContent:`username: ${r}`});t.appendChildren([i]),s.textContent="Logout",s.addEventListener("click",(async()=>{await this.app.authService.logout(),window.location.href="#/"}));const a=document.createElement("div");a.append(s,o),t.appendChildren([a]),this.appendChildren([t,n,S])}async renderUserList(){const t=new e({tag:"ul",className:"user-list"}),n=await this.chatService.getActiveUsers(),s=await this.chatService.getUnauthorizedUsers(),r=[];n.filter((e=>e.login!==this.getCurrUserLogin())).forEach((e=>{const t=document.createElement("li");t.classList.add("line");const n=document.createElement("span"),s=document.createElement("span");s.className="userLogin",n.className="status-online",s.textContent=e.login,t.append(n,s),r.push(t)})),s.forEach((e=>{const t=document.createElement("li");t.classList.add("line");const n=document.createElement("span"),s=document.createElement("span");s.className="userLogin",n.className="status-offline",s.textContent=e.login,t.append(n,s),r.push(t)}));const o=this.getNode().querySelector("main");o&&(t.getNode().append(...r),o.append(t.getNode()))}}class k extends t{constructor(){super({className:"wrapper"})}render(){const e=document.createElement("div");e.classList.add("not-found"),e.textContent="404",this.append(e)}}class A{constructor(e){this.storage=sessionStorage,this.isAuthorized=!1,this.wsService=e}isAuth(){return this.isAuthorized}getUserData(){const e=this.storage.getItem("user");return e?JSON.parse(e):null}setUserData(e){this.storage.setItem("user",JSON.stringify(e))}async auth(e){const t=await this.wsService.message("USER_LOGIN",e),n={authorized:!1,message:""};return t.user&&t.user.isLogined?(this.isAuthorized=!0,this.setUserData(e.user)):t.error&&(n.message=t.error),n.authorized=this.isAuthorized,n}async logout(){const e=this.getUserData();e&&(await this.wsService.message("USER_LOGOUT",{user:e}),this.storage.clear(),this.isAuthorized=!1)}async loginStorage(){const e=this.getUserData();if(e){const t=await this.wsService.message("USER_LOGIN",{user:e});t.user&&t.user.isLogined&&(this.isAuthorized=!0)}return this.isAuthorized}}class T{constructor(){this.eventList={}}on(e,t){return this.eventList[e]||(this.eventList[e]=[]),this.eventList[e].push(t),()=>this.off(e,t)}once(e,t){const n=this.on(e,((...e)=>{n(),t(...e)}))}off(e,t){this.eventList[e]=t?this.eventList[e].filter((e=>t!==e)):[]}emit(e,...t){this.eventList[e]&&this.eventList[e].forEach((e=>{e.call(this,t)}))}}new T;class U extends T{constructor(){super(),this.options={server:"ws://localhost:4000",timeout:30},this.socket=new WebSocket(this.options.server),this.addListeners()}addListeners(){this.socket.addEventListener("open",(()=>{this.emit("open")})),this.socket.addEventListener("close",(()=>{this.emit("close"),this.socket=new WebSocket(this.options.server),this.addListeners()})),this.socket.addEventListener("error",(()=>{this.emit("error")}))}message(e,t){return new Promise(((n,s)=>{const r=Date.now(),o={id:r.toString(),type:e,payload:t},i=e=>{const{data:t}=e;if(!t)return;const s=JSON.parse(t);parseInt(s.id,10)===r&&(this.socket.removeEventListener("message",i),n(s.payload))};setTimeout((()=>{s(new Error("Timeout")),this.socket.removeEventListener("message",i)}),1e3*this.options.timeout),this.socket.addEventListener("message",i),this.socket.send(JSON.stringify(o))}))}}class _{constructor(e){this.root=e;const t=document.createElement("div");t.textContent="Connecting ...",this.loader=t,this.wsService=new U,this.authService=new A(this.wsService),this.wsService.on("open",(async()=>{this.loader.remove(),await this.authService.loginStorage(),this.page?this.root.append(this.page.getNode()):window.location.href="#/login"})),this.wsService.on("close",(()=>{this.root.append(this.loader),this.page&&this.page.getNode().remove()}))}static getInstance(){return _.instance||(_.instance=new _(document.body)),_.instance}renderPage(e){this.page&&this.page.destroy(),this.page=e,this.root.append(e.getNode())}getWs(){return this.wsService}}_.instance=null;const I=_,z=_.getInstance(),j=new Map([["/not-found",()=>{window.location.href="#/not-found",z.renderPage(new k)}],["/",()=>{window.location.href="#/login"}],["/login",()=>{z.authService.isAuth()&&(window.location.href="#/main"),z.renderPage(new y)}],["/about",()=>{z.renderPage(new s)}],["/main",()=>{z.authService.isAuth()||(window.location.href="#/login"),z.renderPage(new C)}]]),O=()=>{const e=window.location.hash.slice(1).toLowerCase(),t=j.get(e||"/")||j.get("/not-found");t&&t()};window.addEventListener("hashchange",O),window.addEventListener("load",(async()=>{z.wsService.once("open",(async()=>{await z.authService.loginStorage(),O()}))}));var P=n(208),M={};M.styleTagTransform=w(),M.setAttributes=g(),M.insert=u().bind(null,"head"),M.domAPI=l(),M.insertStyleElement=f(),c()(P.A,M),P.A&&P.A.locals&&P.A.locals,console.log("Дорогой проверяющий! В моей работе выполнены пункты 1-4, 9-11, частично пункт 5.")})()})();